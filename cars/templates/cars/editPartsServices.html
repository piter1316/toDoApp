{% extends 'todo/base.html' %}
{% load static %}

{% block body %}
<div class="container mt-1">
  <div class="jumbotron shadow shadow-lg">
    <h1 class="">{{service_instance.date}} | {{service_instance.mileage}} km</h1>
    <div>
      {% if messages %}
        <div class="alert alert-info">
          {% for message in messages %}
            <p class="mb-0 text -center">{{ message }}</p>
          {% endfor %}
          <a href="{% url 'cars:car_details' car_id %}#service">Porwrót do listy serwisów</a>
        </div>
      {% endif %}

      <form method="post" id="test">
        {% csrf_token %}
        {{ link_formset.management_form }}

        {% for link_form in link_formset %}
        <div class="link-formset mx-auto">
          <div class="form-row">
            <div class="col">
              {{ link_form.part_service }}
              {% if link_form.anchor.errors %}
                {% for error in link_form.anchor.errors %}
                {{ error|escape }}
                {% endfor %}
              {% endif %}
            </div>
            <div class="col">
              {{ link_form.price }}
              {% if link_form.url.errors %}
                {% for error in link_form.url.errors %}
                {{ error|escape }}
                {% endfor %}
              {% endif %}
            </div>
            <div class="col d-flex align-items-center delete-item ">
              {{ link_form.service }}
              {% if link_form.service.errors %}
                {% for error in link_form.service.errors %}
                {{ error|escape }}
                {% endfor %}
              {% endif %}
            </div>
            <div  class="col d-flex align-items-center"></div>
          </div>
        </div>
        {% endfor %}
        <div class="addNewRow"></div>
        {% if link_formset.non_form_errors %}
        {% for error in link_formset.non_form_errors %}
        {{ error|escape }}
        {% endfor %}
        {% endif %}
        <button type="submit" class="btn btn-success">Zapisz zmiany</button>
        <a href="{% url 'cars:car_details' car_id %}#service" class="btn btn-secondary ">Wróć</a>
      </form>
    </div>
  </div>
</div>

<!-- Include formset plugin - including jQuery dependency -->

<script src="{% static 'todo/jquery.formset.js' %}"></script>
<script>

    $('.link-formset').formset({
        deleteContainerClass: 'delete-item',
        addContainerClass: 'addNewRow',
        addText: 'Nowa część',
        deleteText: 'Usuń',
        keepFieldValues: '.delete-row'
    });
    $('.delete-row').addClass('far fa-trash-alt text-dark ml-2');
    $('.add-row').addClass('fas fa-plus ');


</script>
{% endblock %}