{% extends 'todo/base.html' %}
{% load static %}

{% block body %}
<div class="container mt-1">
  <div class="jumbotron shadow shadow-lg ">
    <h3 class="text-center">{{service_instance.date}} | {{service_instance.mileage}} km</h3>
    <hr>
    <div>
      <form method="post" id="test" enctype="multipart/form-data">
        {% csrf_token %}
        {{ link_formset.management_form }}
        {% for link_form in link_formset %}
        <div class="link-formset mx-auto my-2">
          <div class="form-row py-2 border rounded shadow">
            <div class="col-12 col-lg-4 d-flex flex-row-reverse align-items-center">
              {{ link_form.name }}
              {% if link_form.name.errors %}
                {% for error in link_form.name.errors %}
                {{ error|escape }}
                {% endfor %}
              {% endif %}
            </div>
            <div class="col-12 col-lg-3 d-flex align-items-center ">
              <input readonly value="{% if link_form.file.value %}{{ link_form.file.value }}{% endif %}" class="form-control my-1 mx-auto" id="current_link"/>
            </div>
            <div class="col-12 col-lg-4 d-flex align-items-center ">
              <div class="input-group">
                <div class="input-group-prepend">
                  <span class="input-group-text" id="new_file">Zmień:</span>
                </div>
                <div class="custom-file">
                  {{ link_form.file }}
                  <label class="custom-file-label" data-browse="Przeglądaj" >Wybierz plik...</label>
                </div>
              </div>
            </div>
            <div class="col-12 col-lg-1 delete-item"></div>
          </div>
        </div>
        {% endfor %}
        <div id="addButtonContainer" class="addNewRow"></div>
        {% if link_formset.non_form_errors %}
        {% for error in link_formset.non_form_errors %}
        {{ error|escape }}
        {% endfor %}
        <div class="addButtonContainer"></div>
        {% endif %}
        <hr>
        <div class="d-flex flex-row-reverse bd-highlight">
          <a href="{% url 'cars:car_details' car_id %}#service" class="btn btn-secondary btn-sm ">Wróć</a>
          <button type="submit" class="btn btn-success btn-sm mr-1">Zapisz zmiany</button>
        </div>
      </form>
    </div>
  </div>
</div>

<script src="{% static 'todo/jquery.formset.js' %}"></script>
<script>
function addSpecialFonts(){
  $('.delete-row').addClass('far fa-trash-alt text-light mr-2 btn btn-sm btn-block btn-secondary my-1');
  $('.add-row').addClass('btn btn-block  btn-secondary mt-1');
  $('#addButtonContainer #current_link').val('');
  $('#addButtonContainer #new_file').text('Dodaj: ');
  $('#addButtonContainer input[type=file]').prop('required',true);
  $('.form-row input[type=checkbox]').hide();

  $('#text').hide();

}
function hide_anchor(e){
alert();
}

    $('.link-formset').formset({
        deleteContainerClass: 'delete-item',
        addContainerClass: 'addNewRow',
        addText: 'Dodaj fakturę/paragon',
        deleteText: '',
        keepFieldValues: ''
    });
    addSpecialFonts();


  $('body').on('mouseleave mouseover ','#addButtonContainer',function(e){
    addSpecialFonts();
  });

  $('body').on('touchstart ','#addButtonContainer',function(e){
      setTimeout(function(){ addSpecialFonts(); }, 150);
  });

  $('body').on('change ','input[type=file]',function(){
    var fileName = $(this).val().replace('C:\\fakepath\\', " ");

    $(this).next('.custom-file-label').html(fileName);
    $('#addButtonContainer #current_link').val('fileName');
  });

</script>
{% endblock %}